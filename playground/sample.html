<!DOCTYPE html>
<html>
<head>
    <title>Sample</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
    <script type="text/javascript" src="https://raw.github.com/webadvanced/JavaScript-formatWith-string-extension/master/src/formatWith.js"></script>
    <script type="text/javascript" src="../src/fatBoy.js"></script>
    <script type="text/javascript">
    	var fetchTweets,
    		appendTweets,
    		page = 1,
    		showLoadMore;

    	fetchTweets = function() {
            console.log( page );
    		$.getJSON( 'http://search.twitter.com/search.json?q=javascript&result_type=mixed&callback=?&page=' + page, appendTweets );
    		page++;
    	};

    	appendTweets = function( response ) {
    		var tweets = response.results
    			i = 0,
    			l = 0,
    			$tweetList = $( '#tweets' );
    		if( !tweets || !tweets.length ) return;
    		l = tweets.length;
    		for( ; i < l; i++ ) {
    			$('<li />', {
    				html: '<img src="{profile_image_url}"" /> <small>{from_user}</small><p>{text}</p>'.formatWith( tweets[i] )
    			}).appendTo( $tweetList );
    		}
    	};

        // sleepTheApp = function() {
        //     fb = $(window).fatBoy().myFatBoy();
        //     for( var i = 0; i < 5000000; i++) {
        //         if(i%1000 === 0) {
        //             console.log(fb.canProcess)
        //         }
        //     }
        // };

    	showLoadMore = function() {
    		$('a').show();
    		$('a').click( fetchTweets );
    	};


    	// bind fatBoy ------------------------------------------------------------------------------
    	
    	$(function() {
    		
    		//register using arguments
    		//$( window ).fatBoy({
    		//	callback: fetchTweets,
    		//	limitReached: showLoadMore
    		//});   

    		//register using raw events
            var $window = $( window ),
                myFatBoy;

    		myFatBoy = $window.fatBoy().myFatBoy();
            myFatBoy
                .atBottom( fetchTweets )
                //.atBottom( sleepTheApp )
                .atLimit( showLoadMore );
    		
    		//initial load of tweets
    		fetchTweets();
    	});
    	
    	//-------------------------------------------------------------------------------------------

    </script>
    <style>
    	body {
    		width: 960px;
    		margin: 0 auto;
    	}
    	ul {
    		min-height: 800px;
    	}
    	li {
    		min-height: 150px;
    		list-style: none;
    	}
    	a {
    		display: none;
    	}
    </style>
</head>
<body>
	<h1>Tweets for #javascript</h1>
	<ul id="tweets"></ul>
	<p><a href="#loadmore">load more</a></p>
</body>
</html>